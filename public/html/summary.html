<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podsumowanie Zamówień</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo">Panel Administracyjny - Podsumowanie</div>
        <nav>
            <ul>
                <li><a href="orders.html">Zamówienia</a></li>
                <li><a href="completed-orders.html">Zamówienia Zrealizowane</a></li>
                <li><a href="admin.html">Panel Główny</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="summary">
            <h2>Podsumowanie Zamówień</h2>
            <table id="summary-table" border="1">
                <!-- Tabela zostanie wypełniona dynamicznie -->
            </table>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Sklep z Aromatami. Wszystkie prawa zastrzeżone.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const response = await fetch('https://kuciapki.onrender.com/api/summary');
            const summary = await response.json();
            
            const table = document.getElementById('summary-table');

            // Tworzenie nagłówka tabeli
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = '<th>Produkt</th>';
            
            // Pobranie listy użytkowników z obiektów (kolumny)
            const users = Object.keys(summary);
            users.forEach(user => {
                const th = document.createElement('th');
                th.textContent = user;
                headerRow.appendChild(th);
            });

            // Dodanie nagłówka "Razem zamówione"
            const totalHeader = document.createElement('th');
            totalHeader.textContent = "Razem zamówione";
            headerRow.appendChild(totalHeader);

            table.appendChild(headerRow);

            // Zestawienie produktów
            const productNames = new Set();

            users.forEach(user => {
                Object.keys(summary[user]).forEach(product => {
                    productNames.add(product);
                });
            });

            let totalUserOrders = 0; // Suma wszystkich zamówień użytkowników

            productNames.forEach(product => {
                const row = document.createElement('tr');
                const productCell = document.createElement('td');
                productCell.textContent = product;
                row.appendChild(productCell);

                let productTotal = 0; // Suma dla każdego produktu

                users.forEach(user => {
                    const cell = document.createElement('td');
                    const quantity = summary[user][product] || 0;
                    cell.textContent = quantity;
                    row.appendChild(cell);

                    productTotal += quantity; // Dodanie do sumy produktu
                    totalUserOrders += quantity; // Dodanie do całkowitej sumy użytkownika
                });

                // Dodanie sumy dla produktu
                const totalCell = document.createElement('td');
                totalCell.textContent = productTotal;
                row.appendChild(totalCell);

                table.appendChild(row);
            });

            // Dodanie podsumowania w stopce
            const footerRow = document.createElement('tr');
            const footerCell = document.createElement('td');
            footerCell.setAttribute('colspan', users.length + 1); // Kolumny użytkowników + kolumna Produkt
            footerCell.textContent = "Razem zamówione przez użytkowników:";
            footerRow.appendChild(footerCell);

            // Komórka z łączną liczbą zamówionych produktów
            const totalUserCell = document.createElement('td');
            totalUserCell.textContent = totalUserOrders;
            footerRow.appendChild(totalUserCell);

            table.appendChild(footerRow);
        });
    </script>
</body>
</html>
